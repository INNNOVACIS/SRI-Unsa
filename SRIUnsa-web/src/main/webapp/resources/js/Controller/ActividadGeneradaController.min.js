
investigacionApp.controller("ActividadGeneradaController",["$log","$scope","$routeParams","$location","TipoInvestigacionService","ArchivosService","ActividadesPendientesService","SharedService","ActividadesGeneradasService","SRIUnsaConfig",function(s,r,j,l,u,k,b,o,a,y){r.sharedService=o;r.sharedService.scrollTop();r.loader=false;r.idActividad=j.ID;r.revisado=false;r.generado=false;r.pendiente=false;r.vicerector=false;var w=j.ESTADO;if(w==="Revisadas"){r.revisado=true}if(w==="Generadas"){r.generado=true}if(w==="Pendientes"){r.pendiente=true}if(r.sharedService.locationHome==="/homeVicerector"){r.vicerector=true}var v=function(z){s.debug("GetTipoInvestigacion - Success");console.log("Respuesta :: ",z);r.tipoInvestigaciones=z;i(r.actividadInvestigacion.nidTipoActividadInvestigacion)};var c=function(z){s.debug("GetTipoInvestigacion - Error");console.log("Respuesta :: ",z)};var g=function(z){s.debug("getActividadById - Success");console.log("Respuesta :: ",z);r.actividadInvestigacion=z.body.actividadInvestigacion;r.actividadInvestigacion.dfechaRegistro=r.sharedService.dateToString(r.actividadInvestigacion.dfechaRegistro);r.actividadInvestigacion.dfechaFin=r.sharedService.dateToString(r.actividadInvestigacion.dfechaFin);r.actividadInvestigacion.dfechaAceptacion=r.sharedService.dateToString(r.actividadInvestigacion.dfechaAceptacion);r.changeTipoProduccion(r.actividadInvestigacion.sritipoProduccion);m(z.body.actividadInvestigacion,z.body.colaboradores);r.getTipoInvestigacion();r.getArchivosByIdActividad(r.actividadInvestigacion.nidActividadInvestigacion)};var n=function(z){s.debug("GetInvestigacionById - Error");console.log("Respuesta :: ",z);r.loader=false};var f=function(z){s.debug("getArchivoByIdActividad - Success");console.log("Respuesta :: ",z);r.archivos=z;setTimeout(function(){r.$apply(function(){r.loader=false})},1000)};var p=function(z){s.debug("getArchivoByIdActividad - Success");console.log("Respuesta :: ",z);r.loader=false};var q=function(z){s.debug("descargarArchivo - Success");console.log("Respuesta :: ",z)};var d=function(z){s.debug("descargarArchivo - Error");console.log("Respuesta :: ",z)};var x=function(z){s.debug("AprobarActividad - Success");console.log("Respuesta :: ",z.body);r.sharedService.scrollTop();r.EnviarEmail(z.body.actividadInvestigacion.nidActividadInvestigacion);setTimeout(function(){r.$apply(function(){var C=o.popUp;var A="Aprobación Exitosa!";var D="La Actividad de Investigación se aprobó correctamente.";var B="";if(r.revisado){B="/actividad/Revisadas"}if(r.generado){B="/actividad/Generadas"}if(r.pendiente){B="/actividad/Pendientes"}if(r.vicerector){B="/actividadesDocente"}var E={open:true,txt:"Ir a Bandeja",fun:function(){C.irPopUp()}};C.showPopUp(A,D,B,E);r.loader=false})},1000)};var h=function(z){s.debug("AprobarActividad - Error");console.log("Respuesta :: ",z)};var e=function(z){s.debug("EnviarEmail - Success");console.log("Respuesta :: ",z)};var t=function(z){s.debug("EnviarEmail - Error");console.log("Respuesta :: ",z)};r.getActividadById=function(z){u.getInvestigacionesById(z).then(g,n)};r.getTipoInvestigacion=function(){u.getInvestigaciones().then(v,c)};r.getArchivosByIdActividad=function(z){r.loader=true;k.getArchivosByIdActividad(z).then(f,p)};r.descargarArchivo=function(z){k.descargarArchivo(z.id).then(q,d)};r.AprobarActividad=function(){r.loader=true;var z={idUsuario:r.sharedService.idUsuario,idFlujoActorOrigen:y.DIUN,idEstado:y.REVISADO,idPlanificacion:-1,codigoActor:y.codeDIUN,actividadInvestigacion:{nidActividadInvestigacion:r.idActividad,suserCreacion:r.actividadInvestigacion.suserCreacion}};b.AprobarActividad(z).then(x,h)};r.RechazarActividad=function(){r.loader=true;r.sharedService.scrollTop();setTimeout(function(){r.$apply(function(){var B=o.popUp;var z="La Actividad se Rechazo con Éxito!";var C="La Actividad paso a estado de revisión.";var A="";if(r.revisado){A="/actividad/Revisadas"}if(r.generado){A="/actividad/Generadas"}if(r.pendiente){A="/actividad/Pendientes"}var D={open:true,txt:"Ir a Bandeja",fun:function(){B.irPopUp()}};B.showPopUp(z,C,A,D);r.loader=false})},1000)};r.EnviarEmail=function(z){var A={idUsuario:r.sharedService.idUsuario,idFlujoActorOrigen:y.DIDE,idEstado:y.REVISADO,idPlanificacion:-1,colaboradores:[],plantillaDocumentoActividad:[],actividadInvestigacion:{nidActividadInvestigacion:z}};a.EnviarEmail(A).then(e,t)};var m=function(z,A){angular.forEach(A,function(C,B){if(z.nidResponsable===C.nidPersona){r.responsable=C.snombre+" "+C.sapellido}if(z.nidDirector===C.nidPersona){r.director=C.snombre+" "+C.sapellido}})};var i=function(z){angular.forEach(r.tipoInvestigaciones,function(B,A){if(B.nidTipoActividadInvestigacion===z){r.nombreTipoActividad=B.snombreActividadInvestigacion}});r.changeTipoActividad(r.nombreTipoActividad)};r.changeTipoProduccion=function(z){if(z.toUpperCase()==="ARTICULO"){r.showVerificacion=true;r.fechaTipoProduccion="Fecha de Aceptacion";r.labelCodigo="DOI";r.labelNombrePublicacion="Nombre de la Revista"}if(z.toUpperCase()==="TEXTO"||z.toUpperCase()==="LIBRO"){r.showVerificacion=true;r.fechaTipoProduccion="Fecha de Publicacion";r.labelCodigo="ISBN";r.labelNombrePublicacion="Nombre de la Editorial"}};r.irBandejaRevisados=function(){r.loader=true;if(r.generado&&!r.vicerector){l.path("/actividad/Generadas")}if(r.revisado){l.path("/actividad/Revisadas")}if(r.vicerector){l.path("/actividadesDocente")}};r.changeTipoActividad=function(z){r.mostrarActividad=[false,false,false,false];switch(z.toUpperCase()){case"INVESTIGACION FORMATIVA":r.mostrarActividad=[true,false,false,false];r.descripcionLabel="Breve descripcion de la Actividad Formativa";r.tituloLabel="Nombre del curso o Asignatura";r.adjuntar="Adjuntar Sílabo del Curso";r.adjuntarOtros="Adjuntar Resultados de Investigación";r.showDescripcion=true;break;case"ASESORIA DE TESIS":r.mostrarActividad=[false,true,false,false];r.descripcionLabel="Resumen de Tesis";r.tituloLabel="Titulo de Tesis";r.adjuntar="Adjuntar Resolución";r.adjuntarOtros="Otros Medios (Plan de Tesis, Avances, Otros)";r.showDescripcion=false;break;case"INVESTIGACIONES BASICAS Y APLICADAS":r.mostrarActividad=[false,false,true,false];r.descripcionLabel="Resumen de Investigacion";r.tituloLabel="Titulo del Proyecto de Investigacion";r.adjuntar="Adjuntar Contrato";r.adjuntarOtros="Adjuntar Ficha de Postulación";r.showDescripcion=true;break;case"PRODUCCION INTELECTUAL":r.mostrarActividad=[false,false,false,true];r.descripcionLabel="Resumen";r.tituloLabel="Título";r.adjuntar="Adjuntar Planificación";r.adjuntarOtros="Adjuntar Libro o Artículo (Opcional)";r.showDescripcion=false;break;default:r.mostrarActividad=[false,false,false,false];r.descripcionLabel="Resumen";r.tituloLabel="Nombre";r.adjuntar="Adjuntar";r.adjuntarOtros="Adjuntar Otros";r.showDescripcion=true}};r.getActividadById(r.idActividad)}]);