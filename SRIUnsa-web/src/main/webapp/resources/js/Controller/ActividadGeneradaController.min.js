
investigacionApp.controller("ActividadGeneradaController",["$log","$scope","$routeParams","$location","TipoInvestigacionService","ArchivosService","ActividadesPendientesService","SharedService","ActividadesGeneradasService","SRIUnsaConfig",function(r,q,i,k,t,j,b,m,a,x){q.sharedService=m;q.sharedService.scrollTop();q.loader=false;q.idActividad=i.ID;q.revisado=false;q.generado=false;q.pendiente=false;q.vicerector=false;var v=i.ESTADO;if(v==="Revisadas"){q.revisado=true}if(v==="Generadas"){q.generado=true}if(v==="Pendientes"){q.pendiente=true}if(q.sharedService.locationHome==="/homeVicerector"){q.vicerector=true}var u=function(y){r.debug("GetTipoInvestigacion - Success");console.log("Respuesta :: ",y);q.tipoInvestigaciones=y;h(q.actividadGeneradaVista.nidTipoActividadInvestigacion)};var c=function(y){r.debug("GetTipoInvestigacion - Error");console.log("Respuesta :: ",y)};var l=function(y){r.debug("GetInvestigacionById - Success");console.log("Respuesta :: ",y);q.actividadGeneradaVista=y.body.actividadInvestigacion;q.actividadGeneradaVista.dfechaRegistro=q.sharedService.dateToString(q.actividadGeneradaVista.dfechaRegistro);q.actividadGeneradaVista.dfechaFin=q.sharedService.dateToString(q.actividadGeneradaVista.dfechaFin);q.actividadGeneradaVista.dfechaInicio=q.sharedService.dateToString(q.actividadGeneradaVista.dfechaInicio);q.getTipoInvestigacion();q.getArchivosByIdActividad(q.actividadGeneradaVista.nidActividadInvestigacion)};var p=function(y){r.debug("GetInvestigacionById - Error");console.log("Respuesta :: ",y);q.loader=false};var f=function(y){r.debug("getArchivoByIdActividad - Success");console.log("Respuesta :: ",y);q.archivos=y;setTimeout(function(){q.$apply(function(){q.loader=false})},1000)};var n=function(y){r.debug("getArchivoByIdActividad - Success");console.log("Respuesta :: ",y);q.loader=false};var o=function(y){r.debug("descargarArchivo - Success");console.log("Respuesta :: ",y)};var d=function(y){r.debug("descargarArchivo - Error");console.log("Respuesta :: ",y)};var w=function(y){r.debug("AprobarActividad - Success");console.log("Respuesta :: ",y.body);q.sharedService.scrollTop();q.EnviarEmail(y.body.actividadInvestigacion.nidActividadInvestigacion);setTimeout(function(){q.$apply(function(){var B=m.popUp;var z="Aprobación Exitosa!";var C="La Actividad de Investigación se aprobó correctamente.";var A="";if(q.revisado){A="/actividad/Revisadas"}if(q.generado){A="/actividad/Generadas"}if(q.pendiente){A="/actividad/Pendientes"}if(q.vicerector){A="/actividadesDocente"}var D={open:true,txt:"Ir a Bandeja",fun:function(){B.irPopUp()}};B.showPopUp(z,C,A,D);q.loader=false})},1000)};var g=function(y){r.debug("AprobarActividad - Error");console.log("Respuesta :: ",y)};var e=function(y){r.debug("EnviarEmail - Success");console.log("Respuesta :: ",y)};var s=function(y){r.debug("EnviarEmail - Error");console.log("Respuesta :: ",y)};q.getActividadById=function(y){t.getInvestigacionesById(y).then(l,p)};q.getTipoInvestigacion=function(){t.getInvestigaciones().then(u,c)};q.getArchivosByIdActividad=function(y){q.loader=true;j.getArchivosByIdActividad(y).then(f,n)};q.descargarArchivo=function(y){j.descargarArchivo(y.id).then(o,d)};q.AprobarActividad=function(){q.loader=true;var y={idUsuario:q.sharedService.idUsuario,idFlujoActorOrigen:x.DIUN,idEstado:x.REVISADO,idPlanificacion:-1,codigoActor:x.codeDIUN,actividadInvestigacion:{nidActividadInvestigacion:q.idActividad}};b.AprobarActividad(y).then(w,g)};q.RechazarActividad=function(){q.loader=true;q.sharedService.scrollTop();setTimeout(function(){q.$apply(function(){var A=m.popUp;var y="La Actividad se Rechazo con Éxito!";var B="La Actividad paso a estado de revisión.";var z="";if(q.revisado){z="/actividad/Revisadas"}if(q.generado){z="/actividad/Generadas"}if(q.pendiente){z="/actividad/Pendientes"}var C={open:true,txt:"Ir a Bandeja",fun:function(){A.irPopUp()}};A.showPopUp(y,B,z,C);q.loader=false})},1000)};q.EnviarEmail=function(y){var z={idUsuario:q.sharedService.idUsuario,idFlujoActorOrigen:x.DIDE,idEstado:x.REVISADO,idPlanificacion:-1,colaboradores:[],plantillaDocumentoActividad:[],actividadInvestigacion:{nidActividadInvestigacion:y}};a.EnviarEmail(z).then(e,s)};var h=function(y){angular.forEach(q.tipoInvestigaciones,function(A,z){if(A.nidTipoActividadInvestigacion===y){q.nombreTipoActividad=A.snombreActividadInvestigacion}})};q.irBandejaRevisados=function(){q.loader=true;if(q.generado&&!q.vicerector){k.path("/actividad/Generadas")}if(q.revisado){k.path("/actividad/Revisadas")}if(q.vicerector){k.path("/actividadesDocente")}};q.getActividadById(q.idActividad)}]);