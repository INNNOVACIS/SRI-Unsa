
investigacionApp.controller("ActividadesGeneradasController",["$log","$scope","$location","SharedService","FondoConcursableService","SemestreService","TipoInvestigacionService","ActividadesGeneradasService","EstructuraAreaInvestigacionService","TipoNivelService","EstructuraOrganizacionService","SRIUnsaConfig",function(s,q,k,p,l,b,w,a,f,r,t,A){q.sharedService=p;q.loader=false;q.loadTable=false;q.departamentos=[];q.sortType="id";q.sortReverse=false;var h=function(B){s.debug("GetEstructuraOrganizacion - Success");console.log("Respuesta :: ",B);angular.forEach(B,function(D,C){if(q.sharedService.usuarioLogin.idFacultad===D.nidPadre){q.departamentos.push(D)}})};var g=function(B){s.debug("GetEstructuraOrganizacion - Error");console.log("Respuesta :: ",B)};var z=function(B){s.debug("GetFondo - Success");console.log("Respuesta :: ",B);q.fondos=B};var m=function(B){s.debug("GetFondo - Error",B);console.log("Respuesta :: ",B)};var x=function(B){s.debug("GetSemestre - Success");console.log("Respuesta :: ",B);q.semestres=B};var v=function(B){s.debug("GetSemestre - Error");console.log("Respuesta :: ",B)};var y=function(B){s.debug("GetInvestigacion - Success");console.log("Respuesta :: ",B);q.tipoInvestigaciones=B};var e=function(B){s.debug("GetInvestigacion - Error");console.log("Respuesta :: ",B)};var n=function(B){s.debug("GetAreaInvestigacion - Success");console.log("Respuesta :: ",B);q.areaInvestigaciones=B};var d=function(B){s.debug("GetAreaInvestigacion - Error");console.log("Respuesta :: ",B)};var i=function(C){s.debug("EnviarEmail - Success");console.log("Respuesta :: ",C);q.loader=false;var E=p.popUp;var B="Tu mensaje ha sido enviado.";var F="El recordatorio de la Actividad fue enviado con Ã©xito.";var D="/actividad/Generadas";var G={open:true,txt:"Cerrar",fun:function(){E.irPopUp()}};E.showPopUp(B,F,D,G)};var u=function(B){s.debug("EnviarEmail - Error");console.log("Respuesta :: ",B);q.loader=false};q.getEstructuraOrganizaciones=function(){t.getEstructuraOrganizaciones().then(h,g)};q.getAreaInvestigaciones=function(){f.getAreaInvestigaciones().then(n,d)};q.getFondos=function(){l.getFondos().then(z,m)};q.getSemestres=function(){b.getSemestres().then(x,v)};q.getTipoInvestigacion=function(){w.getInvestigaciones().then(y,e)};q.rangoPaginas=[5,10,20,100];q.currentPage=1;q.currentRango=q.rangoPaginas[0];q.maxSize=5;q.total=0;q.numPages=function(){return Math.ceil(q.total/q.currentRango)};q.$watch("currentPage + currentRango",function(){q.getActividades();q.row=(q.currentPage-1)*q.currentRango+1});var j=function(){var B={nidTipoActividadInvestigacion:(q.tipoInvestigacion===null||q.tipoInvestigacion===undefined||q.tipoInvestigacion==="")?"":q.tipoInvestigacion.nidTipoActividadInvestigacion,sfacultad:(q.facultad===null||q.facultad===undefined||q.facultad==="")?"":q.facultad.snombreEstructuraOrganizacion,sdepartamento:(q.departamento===null||q.departamento===undefined||q.departamento==="")?"":q.departamento.snombreEstructuraOrganizacion,sescuela:(q.escuela===null||q.escuela===undefined||q.escuela==="")?"":q.escuela.snombreEstructuraOrganizacion,ssemestre:(q.semestre===null||q.semestre===undefined||q.semestre==="")?"":q.semestre.snombreSemestre,sfondoConcursable:(q.fondo===null||q.fondo===undefined||q.fondo==="")?"":q.fondo.snombreFondoConcursable};return B};var o=function(B){s.debug("GetActividadesGeneradas - Success");console.log("Respuesta :: ",B);q.actividadesGeneradas=B.lista;q.total=B.total;q.loadTable=false};var c=function(B){s.debug("GetActividadesGeneradas - Error");console.log("Respuesta :: ",B);q.loadTable=false};q.getActividades=function(){var B={currentPage:q.currentPage,rango:q.currentRango,total:q.total,idUsuario:q.sharedService.idUsuario,idEstado:A.CREADO,idFlujoActor:"",filtro:j()};a.GetActividadesGeneradas(B).then(o,c)};q.filtrar=function(){q.loadTable=true;setTimeout(function(){q.getActividades()},500)};q.getEstructuraOrganizaciones();q.getFondos();q.getSemestres();q.getTipoInvestigacion();q.getActividades();q.verActividadById=function(B){q.sharedService.scrollTop();q.loader=true;k.path("/actividad/Generadas/"+B.idactividadinvestigacion)};q.updateActividadById=function(B){q.sharedService.scrollTop();q.loader=true;k.path("/actividad/Generadas/update/"+B.idactividadinvestigacion)};q.EnviarEmail=function(B){q.loader=true;var C={idUsuario:q.sharedService.idUsuario,idFlujoActorOrigen:A.DOCE,idEstado:A.CREADO,idPlanificacion:-1,actividadInvestigacion:{nidActividadInvestigacion:B.idactividadinvestigacion}};a.EnviarEmail(C).then(i,u)};q.descargarPDF=function(){console.log("Empezando descarga de PDF...");var B={currentPage:q.currentPage,rango:q.currentRango,total:q.total,idUsuario:q.sharedService.idUsuario,idEstado:A.CREADO,idFlujoActor:"",filtro:j()};a.descargarPDF(B).then(o,c)}}]);