
investigacionApp.controller("ActividadesGeneradasController",["$log","$scope","$location","SharedService","FondoConcursableService","SemestreService","TipoInvestigacionService","ActividadesGeneradasService","EstructuraAreaInvestigacionService","TipoNivelService","EstructuraOrganizacionService","SRIUnsaConfig",function(t,r,l,q,m,b,z,a,f,s,u,C){r.sharedService=q;r.loader=false;r.loadTable=false;r.sortType="id";r.sortReverse=false;var w=function(D){t.debug("GettipoNivel - Success");console.log("Respuesta :: ",D);r.niveles=D;r.getEstructuraOrganizaciones()};var o=function(D){t.debug("GetTipoNivel - Error");console.log("Respuesta :: ",D)};var h=function(D){t.debug("GetEstructuraOrganizacion - Success");console.log("Respuesta :: ",D);angular.forEach(D,function(F,E){angular.forEach(D,function(H,G){if(F.nidPadre===H.nidEstructuraOrganizacion){F.nombrePadre=H.snombreEstructuraOrganizacion}});angular.forEach(r.niveles,function(H,G){if(F.nidTipoNivel===H.nidTipoNivel){F.nombreTipoNivel=H.snombreTipoNivel}})});r.estructuraOrganizaciones=D};var g=function(D){t.debug("GetEstructuraOrganizacion - Error");console.log("Respuesta :: ",D)};var B=function(D){t.debug("GetFondo - Success");console.log("Respuesta :: ",D);r.fondos=D};var k=function(D){t.debug("GetFondo - Error",D);console.log("Respuesta :: ",D)};var y=function(D){t.debug("GetSemestre - Success");console.log("Respuesta :: ",D);r.semestres=D};var x=function(D){t.debug("GetSemestre - Error");console.log("Respuesta :: ",D)};var A=function(D){t.debug("GetInvestigacion - Success");console.log("Respuesta :: ",D);r.tipoInvestigaciones=D};var e=function(D){t.debug("GetInvestigacion - Error");console.log("Respuesta :: ",D)};var n=function(D){t.debug("GetAreaInvestigacion - Success");console.log("Respuesta :: ",D);r.areaInvestigaciones=D};var d=function(D){t.debug("GetAreaInvestigacion - Error");console.log("Respuesta :: ",D)};var i=function(E){t.debug("EnviarEmail - Success");console.log("Respuesta :: ",E);r.loader=false;var G=q.popUp;var D="Tu mensaje ha sido enviado.";var H="El recordatorio de la Actividad fue enviado con Ã©xito.";var F="/actividad/Generadas";var I={open:true,txt:"Cerrar",fun:function(){G.irPopUp()}};G.showPopUp(D,H,F,I)};var v=function(D){t.debug("EnviarEmail - Error");console.log("Respuesta :: ",D);r.loader=false};r.getListaTipoNivel=function(){s.getListaTipoNivel().then(w,o)};r.getEstructuraOrganizaciones=function(){u.getEstructuraOrganizaciones().then(h,g)};r.getAreaInvestigaciones=function(){f.getAreaInvestigaciones().then(n,d)};r.getFondos=function(){m.getFondos().then(B,k)};r.getSemestres=function(){b.getSemestres().then(y,x)};r.getTipoInvestigacion=function(){z.getInvestigaciones().then(A,e)};r.facultadChange=function(){r.departamento={};r.escuela={}};r.departamentoChange=function(){r.escuela={}};r.rangoPaginas=[5,10,20,100];r.currentPage=1;r.currentRango=r.rangoPaginas[0];r.maxSize=5;r.total=0;r.numPages=function(){return Math.ceil(r.total/r.currentRango)};r.$watch("currentPage + currentRango",function(){r.getActividades();r.row=(r.currentPage-1)*r.currentRango+1});var j=function(){var D={nidTipoActividadInvestigacion:(r.tipoInvestigacion===null||r.tipoInvestigacion===undefined||r.tipoInvestigacion==="")?"":r.tipoInvestigacion.nidTipoActividadInvestigacion,sfacultad:(r.facultad===null||r.facultad===undefined||r.facultad==="")?"":r.facultad.snombreEstructuraOrganizacion,sdepartamento:(r.departamento===null||r.departamento===undefined||r.departamento==="")?"":r.departamento.snombreEstructuraOrganizacion,sescuela:(r.escuela===null||r.escuela===undefined||r.escuela==="")?"":r.escuela.snombreEstructuraOrganizacion,ssemestre:(r.semestre===null||r.semestre===undefined||r.semestre==="")?"":r.semestre.snombreSemestre,sfondoConcursable:(r.fondo===null||r.fondo===undefined||r.fondo==="")?"":r.fondo.snombreFondoConcursable};return D};var p=function(D){t.debug("GetActividadesGeneradas - Success");console.log("Respuesta :: ",D);r.actividadesGeneradas=D.lista;r.total=D.total;r.loadTable=false};var c=function(D){t.debug("GetActividadesGeneradas - Error");console.log("Respuesta :: ",D);r.loadTable=false};r.getActividades=function(){var D={currentPage:r.currentPage,rango:r.currentRango,total:r.total,idUsuario:r.sharedService.idUsuario,idEstado:C.CREADO,idFlujoActor:"",filtro:j()};a.GetActividadesGeneradas(D).then(p,c)};r.filtrar=function(){r.loadTable=true;setTimeout(function(){r.getActividades()},500)};r.getListaTipoNivel();r.getEstructuraOrganizaciones();r.getFondos();r.getSemestres();r.getTipoInvestigacion();r.getAreaInvestigaciones();r.getActividades();r.verActividadById=function(D){r.sharedService.scrollTop();r.loader=true;l.path("/actividad/Generadas/"+D.idactividadinvestigacion)};r.updateActividadById=function(D){r.sharedService.scrollTop();r.loader=true;l.path("/actividad/Generadas/update/"+D.idactividadinvestigacion)};r.EnviarEmail=function(D){r.loader=true;var E={idUsuario:r.sharedService.idUsuario,idFlujoActorOrigen:C.DOCE,idEstado:C.CREADO,idPlanificacion:-1,actividadInvestigacion:{nidActividadInvestigacion:D.idactividadinvestigacion}};a.EnviarEmail(E).then(i,v)};r.descargarPDF=function(){console.log("Empezando descarga de PDF...");var D={currentPage:r.currentPage,rango:r.currentRango,total:r.total,idUsuario:r.sharedService.idUsuario,idEstado:C.CREADO,idFlujoActor:"",filtro:j()};a.descargarPDF(D).then(p,c)}}]);