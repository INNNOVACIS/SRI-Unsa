
investigacionApp.controller("ActividadesRevisadasMasivasController",["$log","$scope","$location","ActividadesGeneradasService","SemestreService","TipoInvestigacionService","FondoConcursableService","TipoNivelService","EstructuraOrganizacionService","SharedService","SRIUnsaConfig","UsuarioFlujoService","ActividadesRevisadasMasivasService",function(J,n,B,e,f,x,k,r,c,i,l,d,u){n.sharedService=i;n.loader=false;n.showDetalle=false;var t=function(K){J.debug("GetTipoNivel - Success");console.log("Respuesta :: ",K);n.niveles=K;n.getEstructuraOrganizaciones()};var w=function(K){J.debug("GetTipoNivel - Error");console.log("Respuesta :: ",K)};var g=function(K){J.debug("GetEstructuraOrganizacion - Success");console.log("Respuesta :: ",K);angular.forEach(K,function(M,L){angular.forEach(K,function(O,N){if(M.nidPadre===O.nidEstructuraOrganizacion){M.nombrePadre=O.snombreEstructuraOrganizacion}});angular.forEach(n.niveles,function(O,N){if(M.nidTipoNivel===O.nidTipoNivel){M.nombreTipoNivel=O.snombreTipoNivel}})});n.estructuraOrganizaciones=K};var h=function(K){J.debug("GetEstructuraOrganizacion - Error");console.log("Respuesta :: ",K)};var I=function(K){J.debug("GetFondo - Success");console.log("Respuesta :: ",K);n.fondos=K};var j=function(K){J.debug("GetFondo - Error");console.log("Respuesta :: ",K)};var y=function(K){J.debug("GetTipoInvestigacion - Success");console.log("Respuesta :: ",K);n.tipoInvestigaciones=K};var s=function(K){J.debug("GetTipoInvestigacion - Error");console.log("Respuesta :: ",K)};var o=function(K){J.debug("GetSemestre - Success");console.log("Respuesta :: ",K);n.semestres=K};var z=function(K){J.debug("GetSemestre - Error");console.log("Respuesta :: ",K)};var a=function(K){J.debug("CreateAndGetUsuarioFlujo - Success");console.log("Respuesta :: ",K)};var q=function(K){J.debug("CreateAndGetUsuarioFlujo - Error");console.log("Respuesta :: ",K)};var A=function(K){J.debug("AprobarActividades - Success");console.log("Respuesta :: ",K);n.GetActividadesRevisadasMasivas();angular.forEach(K.body,function(M,L){n.EnviarEmail(M.actividadInvestigacion.nidActividadInvestigacion)});n.sharedService.scrollTop();setTimeout(function(){n.$apply(function(){var N=i.popUp;var L="Aprobación Exitosa!";var O="Las Actividades de Investigación se aprobaron correctamente.";var M="/actividadesRevisadasMasivas";var P={open:true,txt:"Ir a Bandeja",fun:function(){N.irPopUp()}};N.showPopUp(L,O,M,P);n.loader=false})},1000)};var F=function(K){J.debug("AprobarActividades - Error");console.log("Respuesta :: ",K)};var C=function(K){J.debug("GetCabeceraMasiva - success");console.log("Respuesta :: ",K);n.cabeceras=K.body};var E=function(K){J.debug("GetCabeceraMasiva - Error");console.log("Respuesta :: ",K)};var b=function(K){J.debug("EnviarEmail - Success");console.log("Respuesta :: ",K)};var H=function(K){J.debug("EnviarEmail - Error");console.log("Respuesta :: ",K)};n.getListaTipoNivel=function(){r.getListaTipoNivel().then(t,w)};n.getEstructuraOrganizaciones=function(){c.getEstructuraOrganizaciones().then(g,h)};n.getFondos=function(){k.getFondos().then(I,j)};n.getSemestres=function(){f.getSemestres().then(o,z)};n.getTipoInvestigacion=function(){x.getInvestigaciones().then(y,s)};n.CrearOrActualizarUsuarioFlujo=function(){var K={nidFlujoActor:l.DIDE,nidUsuario:n.sharedService.idUsuario};d.CreateAndGetUsuarioFlujo(K).then(a,q)};n.facultadChange=function(){n.departamento={};n.escuela={}};n.departamentoChange=function(){n.escuela={}};n.aprobarActividades=function(){n.loader=true;var K=[];angular.forEach(n.actividadesRevisadas,function(M,L){if(M.seleccionado!==undefined&&M.seleccionado===true){var N={idUsuario:n.sharedService.idUsuario,idFlujoActorOrigen:l.DIUN,idEstado:l.REVISADO,idPlanificacion:-1,codigoActor:l.codeDIUN,actividadInvestigacion:{nidActividadInvestigacion:M.idactividadinvestigacion}};K.push(N)}});u.AprobarActividades(K).then(A,F)};n.seleccionarTodo=function(K){angular.forEach(n.actividadesRevisadas,function(M,L){if(K===true){M.seleccionado=true}else{M.seleccionado=false}})};n.GetCabeceraMasiva=function(){var K=n.sharedService.idUsuario;u.GetCabeceraMasiva(K).then(C,E)};n.EnviarEmail=function(K){var L={idUsuario:n.sharedService.idUsuario,idFlujoActorOrigen:l.DOCE,idEstado:l.CREADO,idPlanificacion:-1,colaboradores:[],plantillaDocumentoActividad:[],actividadInvestigacion:{nidActividadInvestigacion:K}};e.EnviarEmail(L).then(b,H)};n.rangoPaginas=[5,10,20,100];n.currentPage=1;n.currentRango=n.rangoPaginas[0];n.maxSize=5;n.total=0;n.numPages=function(){return Math.ceil(n.total/n.currentRango)};n.$watch("currentPage + currentRango",function(){n.GetActividadesRevisadasMasivas()});var p=function(){var K={nidTipoActividadInvestigacion:(n.tipoInvestigacion===null||n.tipoInvestigacion===undefined)?"":n.tipoInvestigacion.nidTipoActividadInvestigacion,sfacultad:(n.facultad===null||n.facultad===undefined)?"":n.facultad.snombreEstructuraOrganizacion,sdepartamento:(n.departamento===null||n.departamento===undefined)?"":n.departamento.snombreEstructuraOrganizacion,sescuela:(n.escuela===null||n.escuela===undefined)?"":n.escuela.snombreEstructuraOrganizacion,ssemestre:(n.semestre===null||n.semestre===undefined)?"":n.semestre.snombreSemestre,sfondoConcursable:(n.fondo===null||n.fondo===undefined)?"":n.fondo.snombreFondoConcursable};return K};var D=function(K){J.debug("GetActividadesRevisadas - Success");console.log("Respuesta :: ",K);n.actividadesRevisadas=[];n.actividadesRevisadas=K.lista;n.total=K.total};var G=function(K){J.debug("GetActividadesRevisadas - Error");console.log("Respuesta :: ",K)};n.GetActividadesRevisadasMasivas=function(){var K={currentPage:n.currentPage,rango:n.currentRango,total:n.total,idUsuario:n.sharedService.idUsuario,idEstado:l.REVISADO,idFlujoActor:l.DIUN,filtro:p()};u.GetActividadesRevisadasMasivas(K).then(D,G)};n.filtrar=function(){n.GetActividadesRevisadasMasivas()};n.getListaTipoNivel();n.getFondos();n.getSemestres();n.getTipoInvestigacion();n.CrearOrActualizarUsuarioFlujo();n.GetActividadesRevisadasMasivas();n.verActividadById=function(K){n.loader=true;B.path("/actividad/Revisadas/"+K.idactividadinvestigacion)};n.showDetalle=false;var m=function(K){J.debug("GetDetalleMasiva - Success");console.log("Respuesta :: ",K);n.detalleMasivas=K.lista;n.showDetalle=true};var v=function(K){J.debug("GetDetalleMasiva - Error");console.log("Respuesta :: ",K)};n.GetDetalleMasiva=function(M){n.detalleMasivas=[];var L={nidTipoActividadInvestigacion:M};var K={currentPage:1,rango:100,total:100,idUsuario:n.sharedService.idUsuario,idEstado:l.REVISADO,idFlujoActor:l.DIUN,filtro:L};u.GetDetalleMasiva(K).then(m,v)}}]);