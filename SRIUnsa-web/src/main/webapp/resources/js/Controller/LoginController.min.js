
investigacionApp.controller("LoginController",["$scope","$location","$log","$sce","SharedService","PrivilegioService","LoginService","UsuariosService",function(n,d,o,h,g,a,k,c){n.sharedService=g;n.loader=false;var q=function(u){o.debug("loginService - Success");console.log("Respuesta :: ",u);if(u!==""){sessvars.usuarioLogin=u;n.sharedService.usuarioLogin=sessvars.usuarioLogin;sessvars.nombreUsuario=u.nombreUsuario;sessvars.nombreRol=u.nombreRol;sessvars.idUsuario=u.idUsuario;sessvars.idRol=u.idRol;sessvars.autenticado=true;sessvars.idPersona=u.idPersona;n.sharedService.nombreUsuario=u.nombreUsuario;n.sharedService.nombreRol=u.nombreRol;n.sharedService.idUsuario=u.idUsuario;n.sharedService.idRol=u.idRol;n.sharedService.userAutenticado=sessvars.autenticado;n.GetPrivilegiosByIdUsuario(u.idUsuario)}else{alert("Usuario no registrado");n.loader=false}};var e=function(u){o.debug("loginService - Error");console.log("Respuesta :: ",u);alert("Usuario no registrado");n.loader=false};var t=function(u){o.debug("GetPrivilegiosByIdUsuario - Success");console.log("Respuesta :: ",u);sessvars.privilegios=u;n.sharedService.privilegios=sessvars.privilegios;sessvars.stringMenu=j(n.sharedService.privilegios);sessvars.htmlMenu=h.trustAsHtml(sessvars.stringMenu);n.sharedService.htmlMenu=sessvars.htmlMenu;sessvars.stringMenuVertical=s(n.sharedService.privilegios);sessvars.htmlMenuVertical=h.trustAsHtml(sessvars.stringMenuVertical);n.ShowMenuVertical(n.sharedService.privilegios);n.sharedService.htmlMenuVertical=sessvars.htmlMenuVertical;n.GetActoresByIdUsuario(n.sharedService.idUsuario);n.GetUsuariosByIdUsuario(n.sharedService.idUsuario)};var p=function(u){o.debug("GetPrivilegiosByIdUsuario - Error");console.log("Respuesta :: ",u);n.loader=false};var i=function(u){o.debug("GetActoresByIdUsuario - Success");console.log("Respuesta :: ",u);sessvars.locationHome=m(u.body);sessvars.crearActividadHome=sessvars.locationHome.replace("/","#");n.sharedService.locationHome=sessvars.locationHome;n.sharedService.crearActividadHome=sessvars.crearActividadHome;d.path(n.sharedService.locationHome)};var f=function(u){o.debug("GetActoresByIdUsuario - Error");console.log("Respuesta :: ",u)};var b=function(u){o.debug("GetUsuariosByIdUsuario - Success");console.log("Respuesta :: ",u);sessvars.usuario=u.body;n.sharedService.usuario=u.body};var l=function(u){o.debug("GetUsuariosByIdUsuario - Error");console.log("Respuesta :: ",u)};n.login=function(){n.loader=true;k.Autenticar(n.usuario).then(q,e)};n.GetPrivilegiosByIdUsuario=function(u){a.GetPrivilegiosByIdUsuario(u).then(t,p)};n.GetActoresByIdUsuario=function(u){c.GetActoresByIdUsuario(u).then(i,f)};n.GetUsuariosByIdUsuario=function(u){c.GetByIdUsuario(u).then(b,l)};var m=function(w){var v=0;var u="";angular.forEach(w,function(y,x){if(y.scodigo==="DOCE"&&v===0){u="/homedocente";sessvars.idUsuarioRegistrar=n.sharedService.usuarioLogin.idUsuario,n.sharedService.idUsuarioRegistrar=sessvars.idUsuarioRegistrar}if(y.scodigo==="DIUN"&&v===0){v=1;u="/homeDirectorUnidad";sessvars.idUsuarioRegistrar=-1,n.sharedService.idUsuarioRegistrar=sessvars.idUsuarioRegistrar}if(y.scodigo==="VICE"){v=2;u="/homeVicerector";sessvars.idUsuarioRegistrar=-1,n.sharedService.idUsuarioRegistrar=sessvars.idUsuarioRegistrar}});return u};var j=function(v){var u="";angular.forEach(v,function(y,w){var x="";if(y.nidPadre===0&&y.surlPrivilegio!==null&&y.surlPrivilegio==="#homeDirectorUnidad"){x=r(y.surlPrivilegio,y.sNombrePrivilegio);u=u+x}});angular.forEach(v,function(y,w){var x="";var z="";if(y.nidPadre===0&&y.surlPrivilegio!==null&&y.surlPrivilegio!=="#homeDirectorUnidad"){x=r(y.surlPrivilegio,y.sNombrePrivilegio)}if(y.nidPadre===0&&y.surlPrivilegio===null&&y.sNombrePrivilegio!=="Permisos"){x='<li class="dropdown"><a class="dropdown-toggle" data-toggle="dropdown"><i class="fa fa-file-o fa-fw"></i> '+y.sNombrePrivilegio+' <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu dropdown-user">';angular.forEach(v,function(B,A){if(B.nidPadre!==0&&B.nidPadre===y.nidPrivilegio){z=z+r(B.surlPrivilegio,B.sNombrePrivilegio);z=z+'<li class="divider"></li>'}});x=x+z+"</ul></li>"}u=u+x});u=u+'<li class="dropdown"> <a class="dropdown-toggle" data-toggle="dropdown"   > <i class="fa fa-user fa-fw"></i>  <i class="fa fa-caret-down"></i></a><ul class="dropdown-menu dropdown-user"><li><a ng-click="logout()"><i class="fa fa-sign-out fa-fw"></i> Salir</a></li> </ul> </li>';return u};var s=function(v){var u='<li class="sidebar-search"><a href="#home"><button class="btn btn-primary" type="button"><i class="fa fa-edit fa-fw"></i>  Crear Actividad</button></a></li>';angular.forEach(v,function(y,w){var x="";var z="";if(y.sNombrePrivilegio==="Actividades Generadas"||y.sNombrePrivilegio==="Actividades Pendientes"||y.sNombrePrivilegio==="Actividades Revisadas"){x=r(y.surlPrivilegio,y.sNombrePrivilegio);u=u+x}});angular.forEach(v,function(y,w){var x="";var z="";if(y.nidPadre===0&&y.surlPrivilegio===null&&y.sNombrePrivilegio!=="Actividades"){x='<li> <a ><i class="fa fa-files-o fa-fw"></i> '+y.sNombrePrivilegio+'<span class="fa arrow"></span></a><ul class="nav nav-second-level">';angular.forEach(v,function(B,A){if(B.nidPadre!==0&&B.nidPadre===y.nidPrivilegio){z=z+r(B.surlPrivilegio,B.sNombrePrivilegio)}});x=x+z+"</ul></li>"}u=u+x});return u};var r=function(u,v){return'<li><a href="'+u+'">'+v+"</a></li>"};n.ShowMenuVertical=function(u){angular.forEach(u,function(w,v){switch(w.snombrePrivilegio.toUpperCase()){case"VICERECTOR":sessvars.vicerector=true;n.sharedService.vicerector=sessvars.vicerector;break;case"HOME DOCENTE":sessvars.homeDocente=true;n.sharedService.homeDocente=sessvars.homeDocente;break;case"HOME DIRECTOR UNIDAD":sessvars.homeDirector=true;n.sharedService.homeDirector=sessvars.homeDirector;break;case"ACTIVIDAD DE INVESTIGACION":sessvars.actividadInvestigacion=true;n.sharedService.actividadInvestigacion=sessvars.actividadInvestigacion;break;case"ACTIVIDAD DOCENTE":sessvars.actividadDocente=true;n.sharedService.actividadDocente=sessvars.actividadDocente;break;case"ACTIVIDADES":sessvars.actividades=true;n.sharedService.actividades=sessvars.actividades;break;case"REPORTES":sessvars.reportes=true;n.sharedService.reportes=sessvars.reportes;break;case"CONFIGURACION":sessvars.configuracion=true;n.sharedService.configuracion=sessvars.configuracion;break;case"PERMISOS":sessvars.permisos=true;n.sharedService.permisos=sessvars.permisos;break;case"GENERADAS":sessvars.generadas=true;n.sharedService.generadas=sessvars.generadas;break;case"PENDIENTES":sessvars.pendientes=true;n.sharedService.pendientes=sessvars.pendientes;break;case"REVISADAS":sessvars.revisadas=true;n.sharedService.revisadas=sessvars.revisadas;break;case"REVISADAS MASIVAS":sessvars.revisadasMasivas=true;n.sharedService.revisadasMasivas=sessvars.revisadasMasivas;break;case"RELACION DOCENTES":sessvars.relacionDocentes=true;n.sharedService.relacionDocentes=sessvars.relacionDocentes;break;case"ARCHIVOS":sessvars.archivos=true;n.sharedService.archivos=sessvars.archivos;break;case"TIPO INVESTIGACION":sessvars.showTipoInvestigacion=true;n.sharedService.showTipoInvestigacion=sessvars.showTipoInvestigacion;break;case"TIPO NIVEL":sessvars.tipoNivel=true;n.sharedService.tipoNivel=sessvars.tipoNivel;break;case"TIPO INVESTIGADOR":sessvars.tipoInvestigador=true;n.sharedService.tipoInvestigador=sessvars.tipoInvestigador;break;case"TIPO DE PRODUCCION":sessvars.tipoProduccion=true;n.sharedService.tipoProduccion=sessvars.tipoProduccion;break;case"TIPO DE ASESORIA":sessvars.tipoAsesoria=true;n.sharedService.tipoAsesoria=sessvars.tipoAsesoria;break;case"SEMESTRES ":sessvars.semestres=true;n.sharedService.semestres=sessvars.semestres;break;case"ESTRUCTURA DE LA ORGANIZACION":sessvars.estructuraOrganizacion=true;n.sharedService.estructuraOrganizacion=sessvars.estructuraOrganizacion;break;case"AREA DE INVESTIGACION":sessvars.areaInvestigacion=true;n.sharedService.areaInvestigacion=sessvars.areaInvestigacion;break;case"FLUJO ARISTA":sessvars.flujoArista=true;n.sharedService.flujoArista=sessvars.flujoArista;break;case"GENERAR CAMPOS":sessvars.generarCampos=true;n.sharedService.generarCampos=sessvars.generarCampos;break;case"FUENTE DE FINANCIAMIENTO":sessvars.fuenteFinanciamiento=true;n.sharedService.fuenteFinanciamiento=sessvars.fuenteFinanciamiento;break;case"USUARIOS":sessvars.usuarios=true;n.sharedService.usuarios=sessvars.usuarios;break;case"ROLES":sessvars.roles=true;n.sharedService.roles=sessvars.roles;break;case"ROL USUARIO":sessvars.rolUsuario=true;n.sharedService.rolUsuario=sessvars.rolUsuario;break;case"PRIVILEGIOS":sessvars.privilegio=true;n.sharedService.privilegio=sessvars.privilegio;break;case"ACTORES":sessvars.actores=true;n.sharedService.actores=sessvars.actores;break;case"USUARIO ACTORES":sessvars.usuarioActores=true;n.sharedService.usuarioActores=sessvars.usuarioActores;break;default:console.log("PRIVILEGIO NO EXISTENTE :: ",w.snombrePrivilegio.toUpperCase())}})}}]);