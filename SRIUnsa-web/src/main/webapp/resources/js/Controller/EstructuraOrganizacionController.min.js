
investigacionApp.controller("EstructuraOrganizacionController",["$log","$scope","$location","$rootScope","$filter","EstructuraOrganizacionService","TipoNivelService","SharedService",function(m,k,e,f,j,n,l,i){k.sharedService=i;k.estructuraOrganizaciones=[];k.estructuraOrganizacion={};var q=function(x){m.debug("GetTipoNivel - Success");console.log("Respuesta :: ",x);k.niveles=x};var g=function(x){m.debug("GetTipoNivel - Error");console.log("Respuesta :: ",x)};var c=function(x){m.debug("GetEstructuraOrganizacion - Success");console.log("Respuesta :: ",x);k.organizaciones=x};var a=function(x){m.debug("GetEstructuraOrganizacion - Error");console.log("Respuesta :: ",x)};var v=function(x){m.debug("RegistrarEstructuraOrganizacion - Success");console.log("Respuesta :: ",x);k.estructuraOrganizaciones.push(k.estructuraOrganizacion);k.estructuraOrganizacion={};k.getEstructuraOrganizacionByPagina()};var s=function(x){m.debug("RegistrarEstructuraOrganizacion - Error");console.log("Respuesta :: ",x)};var h=function(x){m.debug("UpdateEstructuraOrganizacion - Success");console.log("Respuesta :: ",x);k.estructuraOrganizacion=x};var u=function(x){m.debug("UpdateEstructuraOrganizacion - Error");console.log("Respuesta :: ",x)};var w=function(x){m.debug("DeleteEstructuraOrganizacion - Success");console.log("Respuesta :: ",x);k.getEstructuraOrganizacionByPagina()};var t=function(x){m.debug("DeleteEstructuraOrganizacion - Error");console.log("Respuesta :: ",x)};k.getListaTipoNivel=function(){l.getListaTipoNivel().then(q,g)};k.getEstructuraOrganizaciones=function(){n.getEstructuraOrganizaciones().then(c,a)};k.registrarEstructuraOrganizacion=function(){var x={nidPadre:k.dependencia==={}?0:k.dependencia.nidEstructuraOrganizacion,nidTipoNivel:k.nivel.nidTipoNivel,snivel:k.nivel.snombreTipoNivel.toUpperCase(),snombreEstructuraOrganizacion:k.nombre,suserCreacion:k.sharedService.nombreUsuario,sestado:"A"};n.registrarEstructuraOrganizacion(x).then(v,s)};k.updateEstructuraOrganizacion=function(){n.updateEstructuraOrganizacion(k.estructuraOrganizacion).then(h,u)};k.deleteEstructuraOrganizacion=function(x){delete x.dependencia;console.log(x);n.deleteEstructuraOrganizacion(k.estructuraOrganizacion).then(w,t)};k.update=function(x){k.estructuraOrganizacion=x;k.nivel=d(k.estructuraOrganizacion.nidTipoNivel);k.changeNivel(k.nivel);k.dependencia=p(k.estructuraOrganizacion.nidPadre);k.nombre=x.snombreEstructuraOrganizacion};k.getListaTipoNivel();var d=function(x){var y={};angular.forEach(k.niveles,function(A,z){if(A.nidTipoNivel===x){y=A}});return y};var p=function(x){var y={};angular.forEach(k.organizaciones,function(A,z){if(A.nidEstructuraOrganizacion===x){y=A}});return y};var o=function(y){var x="";angular.forEach(k.organizaciones,function(A,z){if(y.nidPadre===A.nidEstructuraOrganizacion){x=A.snombreEstructuraOrganizacion}});if(x===""){x="Facultad"}return x};k.changeNivel=function(x){console.log("changeNivel :: ",x);k.dependencia={};if(x.snombreTipoNivel.toUpperCase()!=="FACULTAD"){k.showDependencia=true;k.dependencias=[];angular.forEach(k.organizaciones,function(z,y){if(z.snivel==="FACULTAD"){k.dependencias.push(z)}})}else{k.dependencias=[];k.showDependencia=false}};k.rangoPaginas=[5,10,20,100];k.currentPage=1;k.currentRango=k.rangoPaginas[0];k.maxSize=5;k.total=0;k.numPages=function(){return Math.ceil(k.total/k.currentRango)};k.$watch("currentPage + currentRango",function(){k.getEstructuraOrganizacionByPagina()});var b=function(x){m.debug("getEstructuraOrganizacionByPaginaSuccess - Success");console.log("Respuestas :: ",x);k.estructuraOrganizaciones=[];angular.forEach(x.lista,function(z,y){z.dependencia=o(z)});k.estructuraOrganizaciones=x.lista;k.total=x.total};var r=function(x){m.debug("getEstructuraOrganizacionByPaginaSuccess - Error");console.log("Respuesta :: ",x)};k.getEstructuraOrganizacionByPagina=function(){var x={currentPage:k.currentPage,rango:k.currentRango,total:k.total,filtro:k.buscar};n.getEstructuraOrganizacionByPagina(x).then(b,r)};k.clickBuscar=function(){k.getEstructuraOrganizacionByPagina()};k.getEstructuraOrganizaciones();k.getEstructuraOrganizacionByPagina()}]);