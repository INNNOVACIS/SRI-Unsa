
investigacionApp.controller("UpdateActividadGeneradaController",["$log","$scope","$location","$routeParams","FondoConcursableService","SemestreService","TipoInvestigacionService","EstructuraAreaInvestigacionService","HomeService","PersonasService","PlantillaDocumentoService","TipoNivelService","EstructuraOrganizacionService","ArchivosService","SharedService","FileUploader","SRIUnsaConfig","$sce",function(X,s,P,T,m,c,J,N,S,k,C,y,a,b,i,A,n,d){s.loader=true;s.idActividad=T.ID;s.sharedService=i;var E=function(aa){X.debug("GettipoNivel - Success");console.log("Respuesta :: ",aa);s.niveles=aa;s.getEstructuraOrganizaciones()};var G=function(aa){X.debug("Get TipoNivel - Error");console.log("Respuesta :: ",aa)};var g=function(aa){X.debug("Get EstructuraOrganizacion - Success");console.log("Respuesta :: ",aa);angular.forEach(aa,function(ac,ab){angular.forEach(aa,function(ae,ad){if(ac.nidPadre===ae.nidEstructuraOrganizacion){ac.nombrePadre=ae.snombreEstructuraOrganizacion}});angular.forEach(s.niveles,function(ae,ad){if(ac.nidTipoNivel===ae.nidTipoNivel){ac.nombreTipoNivel=ae.snombreTipoNivel}})});s.estructuraOrganizaciones=aa};var h=function(aa){X.debug("Get EstructuraOrganizacion - Error");console.log("Respuesta :: ",aa)};var V=function(aa){X.debug("Get Fondo - Success");console.log("Respuesta :: ",aa);s.fondos=aa};var j=function(aa){X.debug("Get Fondo - Error",aa);console.log("Respuesta :: ",aa)};var w=function(aa){X.debug("Get Semestre - Success");console.log("Respuesta :: ",aa);s.semestres=aa};var O=function(aa){X.debug("Get Semestre - Error");console.log("Respuesta :: ",aa)};var L=function(aa){X.debug("Get Investigacion - Success");console.log("Respuesta :: ",aa);s.tipoInvestigaciones=aa};var D=function(aa){X.debug("Get Investigacion - Error");console.log("Respuesta :: ",aa)};var Q=function(aa){X.debug("getActividadInvestigacionById - Success");console.log("Respuesta :: ",aa);s.plantillaDocumentoActividades=aa.body.plantillaDocumentoActividad;s.actividadGeneradaVista=aa.body.actividadInvestigacion;s.actividadGeneradaVista.fechaRegistro=s.sharedService.dateToString(s.actividadGeneradaVista.dfechaRegistro);s.actividadGeneradaVista.fechaFin=s.sharedService.dateToString(s.actividadGeneradaVista.dfechaFin);s.actividadGeneradaVista.fechaInicio=s.sharedService.dateToString(s.actividadGeneradaVista.dfechaInicio);s.colaboradores=aa.body.colaboradores;v(aa.body.actividadInvestigacion);s.changeTipoActividad(s.actividadGeneradaVista.tipoInvestigacion.snombreActividadInvestigacion);s.facultadChange();s.getArchivosByIdActividad(s.actividadGeneradaVista.nidActividadInvestigacion);console.log("ActividadGeneradaModificada :::::: ",s.actividadGeneradaVista)};var f=function(aa){X.debug("getActividadInvestigacionById - Error");console.log("Respuesta :: ",aa);s.loader=false};var t=function(aa){X.debug("getArchivoByIdActividad - Success");console.log("Respuesta :: ",aa);s.archivos=aa};var x=function(aa){X.debug("getArchivoByIdActividad - Error");console.log("Respuesta :: ",aa)};var M=function(aa){X.debug("Get AreaInvestigacion - Success");console.log("Respuesta :: ",aa);s.areaInvestigaciones=aa};var z=function(aa){X.debug("Get AreaInvestigacion - Error");console.log("Respuesta :: ",aa)};var o=function(aa){X.debug("DescargarArchivo - Success");console.log("Respuesta :: ",aa)};var U=function(aa){X.debug("DescargarArchivo - Error");console.log("Respuesta :: ",aa)};var q=function(aa){X.debug("ActualizarActividadInvestigacion - Success");console.log("Respuesta :: ",aa);s.sharedService.scrollTop();setTimeout(function(){s.$apply(function(){var ad=i.popUp;var ab="Actualización Exitosa!";var ae="La Actividad de Investigación se actualizo correctamente.";var ac="/actividad/Generadas";var af={open:true,txt:"Ir a Bandeja",fun:function(){ad.irPopUp()}};ad.showPopUp(ab,ae,ac,af);s.loader=false})},1000)};var r=function(aa){X.debug("ActualizarActividadInvestigacion - Error");console.log("Respuesta :: ",aa);s.loader=false};var Z=function(aa){X.debug("GetPersonas - Success");console.log("Respuesta :: ",aa);s.personas=aa};var I=function(aa){X.debug("GetPersonas - Error");console.log("Respuesta :: ",aa)};var Y=function(ab){X.debug("GetPlantillaDocumentoByFacultad - Success");console.log("Respuesta :: ",ab);s.plantillaDocumento=ab.body;s.campos="";var ad="";var aa='<div class="form-group">';var ac="</div>";angular.forEach(ab.body,function(af,ae){if((ae)%2===0){if(ad===""){ad=aa+af.splantilla}else{ad=ad+ac+aa+af.splantilla}}else{ad=ad+af.splantilla}if(af.stipo==="combobox"){l(af)}});ad=ad+ac;s.campos=d.trustAsHtml(ad);e(s.plantillaDocumentoActividades);s.loader=false};var F=function(aa){X.debug("GetPlantillaDocumentoByFacultad - Error");console.log("Respuesta :: ",aa);s.loader=false};s.getListaTipoNivel=function(){y.getListaTipoNivel().then(E,G)};s.getEstructuraOrganizaciones=function(){a.getEstructuraOrganizaciones().then(g,h)};s.getAreaInvestigaciones=function(){N.getAreaInvestigaciones().then(M,z)};s.getFondos=function(){m.getFondos().then(V,j)};s.getSemestres=function(){c.getSemestres().then(w,O)};s.getArchivosByIdActividad=function(aa){b.getArchivosByIdActividad(aa).then(t,x)};s.getTipoInvestigacion=function(){J.getInvestigaciones().then(L,D)};s.descargarArchivo=function(aa){b.descargarArchivo(aa.id).then(o,U)};s.facultadChange=function(){s.departamento={};s.escuela={}};s.departamentoChange=function(){s.escuela={}};s.GetPersonas=function(){k.getPersonas().then(Z,I)};s.facultadChange=function(){var aa={snombreEstructuraOrganizacion:s.actividadGeneradaVista.sfacultad};C.GetPlantillaDocumentoByFacultad(aa).then(Y,F)};s.getActividadInvestigacionById=function(aa){J.getInvestigacionesById(aa).then(Q,f)};s.AgregarColaborador=function(){if(!u(s.colaboradores,s.persona)){s.colaboradores.push(s.persona);s.colaborador={}}};s.DeleteColaborador=function(ab){var aa=-1;angular.forEach(s.colaboradores,function(ad,ac){if(ad.nidPersona===ab.nidPersona){aa=ac}});s.colaboradores.splice(aa,1)};var v=function(aa){s.actividadGeneradaVista.semestre=s.semestres[K(aa.ssemestre)];s.actividadGeneradaVista.tipoInvestigacion=H(aa.nidTipoActividadInvestigacion);s.actividadGeneradaVista.areaInvestigacion=W(aa.sareaInvestigacion);s.actividadGeneradaVista.subareaInvestigacion=W(aa.ssubAreaInvestigacion);s.actividadGeneradaVista.disciplinaInvestigacion=W(aa.sdisciplina);s.actividadGeneradaVista.responsable=B(aa.nidResponsable)};var K=function(ab){var aa=-1;angular.forEach(s.semestres,function(ad,ac){if(ad.snombreSemestre===ab){aa=ac}});return aa};var H=function(aa){var ab=null;angular.forEach(s.tipoInvestigaciones,function(ad,ac){if(ad.nidTipoActividadInvestigacion===aa){ab=ad}});return ab};var W=function(ab){var aa=null;angular.forEach(s.areaInvestigaciones,function(ad,ac){if(ad.sNombre===ab){aa=ad}});return aa};var B=function(ab){var aa=null;angular.forEach(s.personas,function(ad,ac){if(ad.nidPersona===ab){aa=ad.snombre+" "+ad.sapellido}});return aa};var l=function(aa){s[aa.sopciones]=aa.sdata.split(",")};var u=function(ab,ac){var aa=false;angular.forEach(ab,function(ae,ad){if(ae.nidPersona===ac.nidPersona){aa=true}});return aa};var p=function(){var aa=[];angular.forEach(s.plantillaDocumentoActividades,function(ac,ab){angular.forEach(s.plantillaDocumento,function(af,ad){if(ac.nidPlantillaDocumento===af.nidPlantillaDocumento){var ae={nidPlantillaDocumentoActividad:ac.nidPlantillaDocumentoActividad,nidPlantillaDocumento:af.nidPlantillaDocumento,svalor:s[af.smodel],dfechaCreacion:ac.dfechaCreacion,suserCreacion:ac.suserCreacion,sestado:"A"};aa.push(ae)}})});return aa};var e=function(aa){angular.forEach(aa,function(ac,ab){angular.forEach(s.plantillaDocumento,function(ae,ad){if(ac.nidPlantillaDocumento===ae.nidPlantillaDocumento){s[ae.smodel]=ac.svalor}})})};s.getListaTipoNivel();s.getEstructuraOrganizaciones();s.getFondos();s.getSemestres();s.getTipoInvestigacion();s.getAreaInvestigaciones();s.GetPersonas();setTimeout(function(){s.getActividadInvestigacionById(s.idActividad)},1000);s.actualizarActividadInvestigacion=function(){s.loader=true;s.sharedService.scrollTop();var aa={idUsuario:s.sharedService.idUsuario,idFlujoActorOrigen:n.DOCE,idEstado:n.CREADO,idPlanificacion:-1,colaboradores:s.colaboradores===undefined?[]:s.colaboradores,plantillaDocumentoActividad:p(),actividadInvestigacion:{nidActividadInvestigacion:s.actividadGeneradaVista.nidActividadInvestigacion,nidResponsable:s.actividadGeneradaVista.nidResponsable,nidTipoActividadInvestigacion:s.actividadGeneradaVista.tipoInvestigacion.nidTipoActividadInvestigacion,nhoras:s.actividadGeneradaVista.nhoras,sritipoProduccion:s.actividadGeneradaVista.tipoProduccion===undefined?"":s.actividadGeneradaVista.tipoProduccion,sfondoConcursable:s.actividadGeneradaVista.snombreFondoConcursable,stipoAsesoria:s.actividadGeneradaVista.tipoAsesoria===undefined?"":s.actividadGeneradaVista.tipoAsesoria,ssemestre:s.actividadGeneradaVista.ssemestre,sfacultad:s.actividadGeneradaVista.sfacultad,sescuela:s.actividadGeneradaVista.sescuela,sdepartamento:s.actividadGeneradaVista.sdepartamento,sareaInvestigacion:s.actividadGeneradaVista.sareaInvestigacion,ssubAreaInvestigacion:s.actividadGeneradaVista.ssubAreaInvestigacion,sdisciplina:s.actividadGeneradaVista.sdisciplina,stipoLabor:s.actividadGeneradaVista.stipoLabor===undefined?"":s.actividadGeneradaVista.stipoLabor,snombreActividadInvestigacion:s.actividadGeneradaVista.snombreActividadInvestigacion,sdescripcionActividad:s.actividadGeneradaVista.sdescripcionActividad,navance:s.actividadGeneradaVista.navance,dfechaRegistro:s.actividadGeneradaVista.dfechaRegistro,dfechaInicio:s.actividadGeneradaVista.dfechaInicio,dfechaFin:s.actividadGeneradaVista.dfechaFin,suserCreacion:s.actividadGeneradaVista.suserCreacion,suserModificacion:s.sharedService.nombreUsuario,sestado:"A"}};console.log("actualizacion data :::::  ",aa);S.actualizarInvestigacion(aa).then(q,r)};s.uploadFile=function(){var aa=s.archivo;var ab=new FormData();ab.append("file",aa)};var R=s.uploader=new A({url:n.SRIUnsaUrlServicio+"/files/subirArchivos"});R.filters.push({name:"customFilter",fn:function(ab,aa){return this.queue.length<10}});s.uploadAll=function(){addPlanificacion();R.uploadAll()};s.irBandeja=function(){s.loader=true;P.path("/actividad/Generadas")};s.totalColaboradores=function(){var aa=s.colaboradores===undefined?0:s.colaboradores.length;return aa+" seleccionados"};s.changeTipoActividad=function(aa){s.mostrarActividad=[false,false,false,false];switch(aa.toUpperCase()){case"INVESTIGACION FORMATIVA":s.mostrarActividad=[true,false,false,false];break;case"ASESORIA DE TESIS":s.mostrarActividad=[false,true,false,false];break;case"INVESTIGACIONES BASICAS Y APLICADAS":s.mostrarActividad=[false,false,true,false];break;case"PRODUCCION INTELECTUAL":s.mostrarActividad=[false,false,false,true];break;default:s.mostrarActividad=[false,false,false,false]}}}]);